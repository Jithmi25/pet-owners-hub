<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <link href="admin/assets/css/admin.css" rel="stylesheet">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <title>Reports - Admin Panel</title>
    <link rel="stylesheet" href="../admin/assets/css/admin.css">
    <!-- Include jsPDF library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Loading indicator for PDF generation */
        .pdf-loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
        }
        
        .report-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .report-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .dark-mode .report-card {
            background: #2c3e50;
        }
        
        .chart-placeholder {
            height: 300px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .dark-mode .chart-placeholder {
            background: #34495e;
        }
    </style>
</head>
<body>
    <!-- Admin Panel Navigation Bar -->
    <header>
        <nav>
            <div class="logo">
                <h1>Pet Owners Hub</h1>
            </div>
          <ul class="nav-links">
                <li><a href="dashboard.html" class="active"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="manage-users.html"><i class="fas fa-users"></i> Users</a></li>
                <li><a href="manage-pets.html"><i class="fas fa-paw"></i> Pets</a></li>
                <li><a href="manage-clinics.html"><i class="fas fa-hospital"></i> Clinics</a></li>
                <li><a href="manage-shops.html"><i class="fas fa-store"></i> Shops</a></li>
                <li><a href="reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
                <li><a href="settings.html" class="active"><i class="fas fa-cogs"></i> Settings</a></li>
                <li><a href="../../index.html" id="logout-link"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
            </ul>
        </nav>
    </header>

    <!-- Reports Section -->
    <div class="admin-container">
        <h2>System Reports</h2>
        
        <div class="report-filters">
            <div class="filter-group">
                <label for="reportType">Report Type</label>
                <select class="filter-select" id="reportType">
                    <option value="summary">Summary Report</option>
                    <option value="users">User Activity</option>
                    <option value="pets">Pet Listings</option>
                    <option value="transactions">Transactions</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="dateFrom">From</label>
                <input type="date" class="filter-input" id="dateFrom">
            </div>
            <div class="filter-group">
                <label for="dateTo">To</label>
                <input type="date" class="filter-input" id="dateTo">
            </div>
            <button class="btn btn-primary" id="generateReport">Generate Report</button>
        </div>

        <div class="report-cards">
            <div class="report-card">
                <h3>Total Users</h3>
                <p>Registered in selected period</p>
                <div class="value">452</div>
                <div class="trend up">↑ 12% from last period</div>
            </div>
            <div class="report-card">
                <h3>Pet Listings</h3>
                <p>New pets added</p>
                <div class="value">125</div>
                <div class="trend up">↑ 8% from last period</div>
            </div>
            <div class="report-card">
                <h3>Transactions</h3>
                <p>Completed purchases</p>
                <div class="value">84</div>
                <div class="trend down">↓ 5% from last period</div>
            </div>
            <div class="report-card">
                <h3>Revenue</h3>
                <p>Total system revenue</p>
                <div class="value">Rs. 524,000</div>
                <div class="trend up">↑ 15% from last period</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>User Growth Over Time</h3>
            <div class="chart-placeholder">
                [Chart would be displayed here in a real application]
            </div>
        </div>

        <div class="chart-container">
            <h3>Pet Listings by Type</h3>
            <div class="chart-placeholder">
                [Chart would be displayed here in a real application]
            </div>
        </div>

        <div class="export-options">
            <button class="btn btn-primary" id="exportPDF">Export as PDF</button>
            <button class="btn btn-primary" id="exportCSV">Export as CSV</button>
        </div>
    </div>

    <!-- PDF Loading Indicator -->
    <div class="pdf-loading" id="pdfLoading">
        <i class="fas fa-spinner fa-spin"></i> Generating PDF report...
    </div>

    <button class="dark-mode-toggle" id="darkModeToggle">🌙</button>

    <script>
        // Initialize jsPDF
        window.jsPDF = window.jspdf.jsPDF;

        // JavaScript for Reports
        document.addEventListener('DOMContentLoaded', function() {
            // Highlight current page in navigation
            const currentPage = window.location.pathname.split('/').pop() || 'reports.html';
            const navLinks = document.querySelectorAll('.nav-links a');
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === currentPage) {
                    link.classList.add('active');
                }
            });

            // Set default dates (last 30 days)
            const today = new Date();
            const lastMonth = new Date();
            lastMonth.setMonth(lastMonth.getMonth() - 1);
            
            document.getElementById('dateFrom').valueAsDate = lastMonth;
            document.getElementById('dateTo').valueAsDate = today;

            // Generate report button
            document.getElementById('generateReport').addEventListener('click', function() {
                const reportType = document.getElementById('reportType').value;
                const dateFrom = document.getElementById('dateFrom').value;
                const dateTo = document.getElementById('dateTo').value;
                
                alert(`Generating ${reportType} report from ${dateFrom} to ${dateTo}`);
                // In a real app, this would fetch data and update the charts
            });

            // Export CSV button
            document.getElementById('exportCSV').addEventListener('click', function() {
                alert('Exporting report as CSV');
            });

            // Export PDF button - Fixed functionality
            document.getElementById('exportPDF').addEventListener('click', generatePDFReport);

            // Dark mode toggle functionality
            const darkModeToggle = document.getElementById('darkModeToggle');
            darkModeToggle.addEventListener('click', toggleDarkMode);

            // Check for saved dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                enableDarkMode();
            }
        });

        // Function to generate PDF report
        function generatePDFReport() {
            // Show loading indicator
            const loadingIndicator = document.getElementById('pdfLoading');
            loadingIndicator.style.display = 'block';
            
            // Get report data
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            // Use setTimeout to allow the UI to update with loading indicator
            setTimeout(() => {
                try {
                    // Create new PDF document
                    const doc = new jsPDF();
                    
                    // Add title
                    doc.setFontSize(20);
                    doc.setTextColor(40, 40, 40);
                    doc.text('Pet Owners Hub - System Report', 14, 22);
                    
                    // Add report details
                    doc.setFontSize(12);
                    doc.setTextColor(100, 100, 100);
                    doc.text(`Report Type: ${getReportTypeName(reportType)}`, 14, 32);
                    doc.text(`Period: ${formatDate(dateFrom)} to ${formatDate(dateTo)}`, 14, 39);
                    doc.text(`Generated: ${new Date().toLocaleDateString()}`, 14, 46);
                    
                    // Add summary section
                    doc.setFontSize(16);
                    doc.setTextColor(40, 40, 40);
                    doc.text('Summary', 14, 60);
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    
                    // Add summary data from report cards
                    const reportCards = document.querySelectorAll('.report-card');
                    let yPosition = 70;
                    
                    reportCards.forEach((card, index) => {
                        if (yPosition > 240) {
                            doc.addPage();
                            yPosition = 20;
                        }
                        
                        const title = card.querySelector('h3').textContent;
                        const value = card.querySelector('.value').textContent;
                        const trend = card.querySelector('.trend').textContent;
                        
                        doc.setFontSize(12);
                        doc.setTextColor(40, 40, 40);
                        doc.text(`${title}: ${value}`, 14, yPosition);
                        
                        doc.setFontSize(10);
                        doc.setTextColor(100, 100, 100);
                        doc.text(trend, 14, yPosition + 6);
                        
                        yPosition += 20;
                    });
                    
                    // Add charts section
                    yPosition += 10;
                    if (yPosition > 200) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    doc.setFontSize(16);
                    doc.setTextColor(40, 40, 40);
                    doc.text('Charts Overview', 14, yPosition);
                    yPosition += 15;
                    
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.text('User Growth Over Time: [Chart data would be included]', 14, yPosition);
                    yPosition += 10;
                    doc.text('Pet Listings by Type: [Chart data would be included]', 14, yPosition);
                    
                    // Add footer
                    const pageCount = doc.internal.getNumberOfPages();
                    for (let i = 1; i <= pageCount; i++) {
                        doc.setPage(i);
                        doc.setFontSize(8);
                        doc.setTextColor(150, 150, 150);
                        doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width / 2, doc.internal.pageSize.height - 10, { align: 'center' });
                        doc.text(`Generated by Pet Owners Hub Admin`, doc.internal.pageSize.width - 14, doc.internal.pageSize.height - 10, { align: 'right' });
                    }
                    
                    // Save the PDF
                    const fileName = `Pet_Owners_Report_${reportType}_${dateFrom}_to_${dateTo}.pdf`;
                    doc.save(fileName);
                    
                } catch (error) {
                    console.error('Error generating PDF:', error);
                    alert('Error generating PDF report. Please try again.');
                } finally {
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';
                }
            }, 500);
        }
        
        // Helper function to get report type name
        function getReportTypeName(type) {
            const types = {
                'summary': 'Summary Report',
                'users': 'User Activity',
                'pets': 'Pet Listings',
                'transactions': 'Transactions'
            };
            return types[type] || type;
        }
        
        // Helper function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString();
        }

        function toggleDarkMode() {
            if (document.body.classList.contains('dark-mode')) {
                disableDarkMode();
            } else {
                enableDarkMode();
            }
        }

        function enableDarkMode() {
            document.body.classList.add('dark-mode');
            localStorage.setItem('darkMode', 'enabled');
            document.getElementById('darkModeToggle').textContent = '☀️';
        }

        function disableDarkMode() {
            document.body.classList.remove('dark-mode');
            localStorage.setItem('darkMode', 'disabled');
            document.getElementById('darkModeToggle').textContent = '🌙';
        }
    </script>
</body>
</html>